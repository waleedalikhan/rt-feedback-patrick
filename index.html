<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite + TS</title>
  </head>
  <body class="p-8">
    <div x-data="fastFeedback">
      <div
        id="content"
        x-merge="append"
        class="p-5 bg-gray-200 max-w-screen-md flex flex-wrap gap-8"
      >
        <template x-for="feedback in content" :key="feedback.id">
          <div
            x-data="innerFeedback(feedback)"
            class="bg-white border rounded-xl w-full p-6 flex flex-wrap gap-5 items-start"
          >
            <div class="w-full flex gap-2">
              <div
                class="w-12 relative after:content-[''] after:w-2 after:bottom-0 after:top-16 after:h-full after:bg-gray-200 after:absolute after:left-1/2 after:-translate-x-1/2 overflow-hidden"
                :class="data.replies.length > 0 ? 'after:block' : 'after:hidden'"
              >
                <div class="w-12 h-12">
                  <img src="/user-img.webp" alt="" class="rounded" />
                </div>
              </div>
              <div class="flex-1 flex flex-wrap gap-2">
                <div class="w-full flex items-start gap-2">
                  <div>
                    <p class="text-gray-500 text-sm">
                      <span
                        class="text-lg text-black font-semibold"
                        x-text="data.user.name"
                      ></span>
                      <span x-text="data.user.commentTime"></span>
                    </p>
                    <div class="flex gap-2 text-gray-500">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="size-6"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z"
                        />
                      </svg>
                      <p
                        class="text-black text-lg"
                        x-text="data.user.recognition"
                      ></p>
                    </div>
                  </div>
                  <template
                    x-for="(item, index) in data.user.userReplies"
                    :key="index"
                  >
                    <div class="flex items-center gap-2">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="size-5"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="m8.25 4.5 7.5 7.5-7.5 7.5"
                        />
                      </svg>
                      <div class="flex items-center gap-2">
                        <div class="w-8 h-8">
                          <img :src="item.img" alt="" class="rounded" />
                        </div>
                        <span
                          class="text-lg text-black font-semibold"
                          x-text="item.name"
                        ></span>
                      </div>
                    </div>
                  </template>
                </div>
                <div class="w-full rounded-lg p-5 bg-gray-400">
                  <p class="font-semibold text-white text-lg">Your feedback</p>
                  <p
                    class="text-white line-clamp-3"
                    x-ref="fbContent"
                    x-text="data.feedback"
                    x-effect="toggleTextClamp($refs.fbContent)"
                  ></p>
                  <template x-if="isTextClamped">
                    <button
                      type="button"
                      class="outline-none focus:oultine-none bg-transparent flex gap-2 text-white mt-5"
                      @click="toggleReadMore($refs.fbContent)"
                    >
                      read more
                      <div class="p-1 border border-white rounded-full">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                          stroke="currentColor"
                          :class="`w-4 h-4 transform ${isTextShown ? 'rotate-180' : 'rotate-0'}`"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="m19.5 8.25-7.5 7.5-7.5-7.5"
                          />
                        </svg>
                      </div>
                    </button>
                  </template>
                </div>
                <div class="w-full flex items-center gap-4">
                  <div class="bg-black p-2">
                    <div
                      class="bg-white rounded-full flex items-center gap-2 text-lg px-3 outline-none focus:outline-none"
                    >
                      <div
                        x-data="emojiData"
                        @keydown.escape.prevent.stop="close($refs.button)"
                        @focusin.window="! $refs.panel.contains($event.target) && close()"
                        x-id="['dropdown-button']"
                        class="relative"
                      >
                        <button
                          x-ref="button"
                          @click="toggle()"
                          :aria-expanded="open"
                          :aria-controls="$id('dropdown-button')"
                          type="button"
                          class="bg-white flex outline-none focus:outline-none bg-transparent"
                        >
                          <template
                            x-for="(reaction, index) in data.reactions"
                            :key="index"
                          >
                            <template x-if="index <= 2">
                              <span x-text="reaction"></span>
                            </template>
                          </template>
                        </button>

                        <input
                          type="hidden"
                          id="emoji"
                          x-model="input"
                          value=""
                        />
                        <div
                          x-ref="panel"
                          x-show="open"
                          x-transition.origin.top.left
                          @click.outside="close($refs.button)"
                          :id="$id('dropdown-button')"
                          style="display: none; width: 24.85rem"
                          class="absolute left-0 mt-2 p-4 max-h-64 bg-white shadow-md overflow-scroll rounded"
                        >
                          <input
                            type="search"
                            x-model="search"
                            class="h-10 w-full px-2 mb-2 text-sm border border-1 border-slate-200 bg-gray-50 rounded-md placeholder:text-gray-500"
                            placeholder="Search an emoji..."
                          />
                          <template
                            x-for="(emoji, keywords) in filteredEmojis"
                            :key="emoji"
                          >
                            <button
                              class="inline-block py-2 px-3 m-1 cursor-pointer rounded-md bg-gray-100 hover:bg-blue-100"
                              :title="keywords"
                              @click="input = emoji; toggle(); data.reactions.push(input)"
                            >
                              <span
                                class="inline-block w-5 h-5"
                                x-text="emoji"
                              ></span>
                            </button>
                          </template>
                        </div>
                      </div>
                      <span
                        class="text-black"
                        x-text="data.reactions.length"
                      ></span>
                    </div>
                  </div>
                  <div>
                    <button
                      type="button"
                      class="outline-none focus:outline-none bg-transparent text-2xl text-black"
                      @click="showCommentBlock = true"
                    >
                      Add reply
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <template x-if="showCommentBlock">
              <div class="w-full flex gap-2 items-start">
                <div class="w-12 h-12 grid place-content-center">
                  <div class="w-6 h-6">
                    <img src="/user-img.webp" alt="" class="rounded" />
                  </div>
                </div>
                <div class="flex-1 space-y-4">
                  <textarea
                    rows="1"
                    cols="1"
                    type="text"
                    placeholder="Add a comment"
                    class="outline-none focus:outline-none ring-0 ring-offset-0 focus:ring-0 focus:ring-offset-0 border focus:border-black rounded h-10 px-4 pt-2 w-full grid place-content-center"
                    x-model="data.reply"
                  ></textarea>
                  <button
                    type="button"
                    class="px-4 py-2 rounded-full text-white outline-none focus:outline-none bg-green-500"
                    @click="data.replies.push({img: '/user-img.webp', name: 'Patrick Fitzgerald', time: 'just now', reply: data.reply}); showCommentBlock = false; data.reply = ''"
                  >
                    Submit
                  </button>
                </div>
              </div>
            </template>
            <template x-for="(reply, index) in data.replies" :key="index">
              <div class="w-full flex gap-2 items-start">
                <div class="w-12 h-12 flex justify-center">
                  <div class="w-6 h-6">
                    <img :src="reply.img" alt="" class="rounded" />
                  </div>
                </div>
                <div class="flex-1 space-y-2">
                  <p class="text-gray-500 flex gap-2 items-center">
                    <span
                      class="text-black text-lg font-semibold"
                      x-text="reply.name"
                    ></span>
                    <span x-text="reply.time"></span>
                  </p>
                  <div class="w-full p-5 rounded-lg bg-gray-100">
                    <p class="text-black" x-text="reply.reply"></p>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </template>
      </div>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
